# ğŸ” Member vs User Authentication

> Understand the difference between **Users** and **Members** in Umbraco, when to use each, and how to build login-protected areas for site visitors ğŸ§ ğŸ›¡ï¸

---

## ğŸ¤” Whatâ€™s the Difference?

| Feature       | **User**                               | **Member**                                |
| ------------- | -------------------------------------- | ----------------------------------------- |
| Who?          | Backoffice users (editors/admins/devs) | Public site users (customers, members)    |
| Access        | `/umbraco` dashboard                   | Frontend website                          |
| Auth Location | Login via `/umbraco`                   | Login via Razor or API                    |
| Role System   | Granular section permissions           | Groups + role-based protection            |
| Use Case      | Content editors, devs, admins          | Members-only pages, subscriptions, forums |

âœ… For frontend **logins and protected pages**, you'll use **Members**.

---

## ğŸ§  Common Use Cases for Members

| Scenario                      | Use Member?   |
| ----------------------------- | ------------- |
| ğŸ“° Newsletter subscribers     | âœ… Yes        |
| ğŸ’¬ Forum participants         | âœ… Yes        |
| ğŸ“š Online course students     | âœ… Yes        |
| ğŸ¯ Admin editing content      | âŒ (Use User) |
| ğŸ§¾ Clients accessing invoices | âœ… Yes        |

---

## ğŸ§± Step-by-Step: Member Login System in Razor

---

### ğŸ§° Step 1: Create Member Type

> Backoffice â†’ **Members** â†’ Member Types â†’ â• New Member Type

Name: `RegisteredUser`

âœ”ï¸ Add properties like:

- `email` (TextString)
- `firstName` (TextString)
- `isActive` (True/False)

ğŸ“Œ Important:

- Check âœ… â€œIs an Umbraco Login Memberâ€
- Set `email` as Login field

---

### âœ… Step 2: Create Registration SurfaceController

ğŸ“ `Controllers/RegisterSurfaceController.cs`

```csharp
public class RegisterSurfaceController : SurfaceController
{
    private readonly IMemberManager _memberManager;
    private readonly IMemberService _memberService;

    public RegisterSurfaceController(
        IMemberManager memberManager,
        IMemberService memberService,
        ...base params...
    ) : base(...) {
        _memberManager = memberManager;
        _memberService = memberService;
    }

    [HttpPost]
    public async Task<IActionResult> Submit(string email, string password)
    {
        if (await _memberManager.ExistsAsync(email))
        {
            TempData["Error"] = "Member already exists.";
            return RedirectToCurrentUmbracoPage();
        }

        var member = _memberService.CreateMember(email, email, email, "RegisteredUser");
        _memberService.SavePassword(member, password);

        await _memberManager.SignInAsync(HttpContext, email);

        return RedirectToCurrentUmbracoPage();
    }
}
```

---

### âœ… Step 3: Razor Form for Signup

In `Views/Register.cshtml`:

```cshtml
@using (Html.BeginUmbracoForm("Submit", "RegisterSurface"))
{
    <input type="email" name="email" placeholder="Email" required />
    <input type="password" name="password" placeholder="Password" required />
    <button type="submit">Register</button>
}
```

---

### ğŸ§  Step 4: Login Form + Logic

ğŸ“ `Controllers/LoginSurfaceController.cs`

```csharp
public class LoginSurfaceController : SurfaceController
{
    private readonly IMemberManager _memberManager;

    public LoginSurfaceController(IMemberManager memberManager, ...) : base(...)
    {
        _memberManager = memberManager;
    }

    [HttpPost]
    public async Task<IActionResult> Login(string email, string password)
    {
        var result = await _memberManager.PasswordSignInAsync(HttpContext, email, password, true);

        if (result.Succeeded)
            return RedirectToCurrentUmbracoPage();

        TempData["Error"] = "Invalid login";
        return RedirectToCurrentUmbracoPage();
    }
}
```

---

### ğŸ“ Razor Login Form

```cshtml
@using (Html.BeginUmbracoForm("Login", "LoginSurface"))
{
    <input type="email" name="email" placeholder="Email" required />
    <input type="password" name="password" placeholder="Password" required />
    <button type="submit">Login</button>
}
```

---

## ğŸ”’ Step 5: Protect a Page from Anonymous Visitors

> In Backoffice â†’ **Content â†’ Right-click page â†’ Public Access**

Choose:

- ğŸ” Role based protection
- âœ… Member group: `RegisteredUsers`

Umbraco will prompt:

- **Login page** â†’ Set to a login form
- **Error page** â†’ Set to "No access" message

Only logged-in members can view the page now! ğŸ”ğŸ‰

---

## ğŸ™‹â€â™‚ï¸ Bonus: Check If a Member Is Logged In

In Razor:

```cshtml
@if (User.Identity.IsAuthenticated && Member != null)
{
    <p>Welcome @Member.Name!</p>
}
```

---

## ğŸ”š Logout Action

```html
<form method="post" action="/umbraco/Surface/Member/Logout">
  <button type="submit">Logout</button>
</form>
```

Or programmatically:

```csharp
await _memberManager.SignOutAsync(HttpContext);
```

---

## âœ… Summary

| Concept      | Member (Frontend)     | User (Backoffice)        |
| ------------ | --------------------- | ------------------------ |
| Login Area   | Site (form)           | `/umbraco`               |
| Auth Service | `IMemberManager`      | `IBackOfficeUserManager` |
| Protection   | Public Access         | Permissions/Groups       |
| Common Use   | Registered site users | Admins, editors          |

---

## ğŸš€ Practice Challenge

- Create a "VIP Members" section with:

  - Signup page
  - Login form
  - Protected content (like a special eBook or download)
  - Logout button
