# ğŸ³ Docker Compose Setup with SQL Server

> Real-world example of running Umbraco v13 in Docker with SQL Server + persistent volumes like a DevOps wizard ğŸ§™â€â™‚ï¸ğŸ³ğŸ—ƒï¸

---

## ğŸ¯ Goal

Weâ€™ll spin up:

- An **Umbraco v13 container** (ASP.NET Core)
- A **SQL Server container**
- **Volumes** to persist database & media files across restarts

---

## ğŸ§¾ Prerequisites

âœ… [Docker Desktop](https://www.docker.com/products/docker-desktop/) installed
âœ… Your terminal/VS Code ready
âœ… Basic understanding of `docker-compose`

---

## ğŸ“ Folder Structure

```ini
umbraco-docker/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ umbraco/          <-- Mounted for media/config persistence
â”œâ”€â”€ data/             <-- SQL Server data volume
```

---

## ğŸ³ `docker-compose.yml`

```yaml
version: "3.8"

services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-lts
    container_name: sqlserver
    environment:
      SA_PASSWORD: "P@ssw0rd1234!"
      ACCEPT_EULA: "Y"
    ports:
      - "1433:1433"
    volumes:
      - sql_data:/var/opt/mssql

  umbraco:
    image: umbraco/umbraco:13
    container_name: umbraco
    ports:
      - "8080:80"
    depends_on:
      - sqlserver
    environment:
      UMBRACO__CMS__GLOBAL__INSTALLUNATTENDED: "true"
      UMBRACO__CMS__UNATTENDEDINSTALL__ADMINEMAIL: "admin@example.com"
      UMBRACO__CMS__UNATTENDEDINSTALL__ADMINPASSWORD: "Admin123!"
      UMBRACO__CMS__UNATTENDEDINSTALL__ADMINUSERNAME: "admin"
      UMBRACO__CMS__DATABASES__0__CONNECTIONSTRING: "Server=sqlserver;Database=UmbracoDb;User Id=sa;Password=P@ssw0rd1234!"
      UMBRACO__CMS__DATABASES__0__PROVIDER: "Microsoft.Data.SqlClient"
    volumes:
      - ./umbraco:/app/umbraco

volumes:
  sql_data:
```

---

## ğŸ§  Explanation of Key Parts

| Section             | What It Does                               |
| ------------------- | ------------------------------------------ |
| `sqlserver` service | Starts SQL Server 2022 with password       |
| `umbraco` service   | Pulls Umbraco v13 official image           |
| `depends_on`        | Waits for SQL Server container to be ready |
| `volumes`           | Persists SQL data + Umbraco media/config   |
| `UNATTENDEDINSTALL` | Skips UI wizard and installs via env vars  |

---

## ğŸ”¥ Run It

In your terminal:

```bash
docker compose up -d
```

Check logs:

```bash
docker compose logs -f umbraco
```

---

## ğŸŒ Access Your Site

Go to: [http://localhost:8080](http://localhost:8080)
Login:

- âœ‰ï¸ Email: `admin@example.com`
- ğŸ”’ Password: `Admin123!`

ğŸ‰ Youâ€™re inside the Umbraco backoffice!

---

## ğŸ“‚ Persistent Volumes

| Volume      | Purpose                                      |
| ----------- | -------------------------------------------- |
| `sql_data`  | Saves your SQL DB across restarts            |
| `./umbraco` | Keeps media files and config changes locally |

You can inspect with:

```bash
docker volume ls
docker volume inspect umbraco-docker_sql_data
```

---

## ğŸ§  Diagram of Setup

```mermaid
graph TD
  A[Your Host Machine] --> B[Docker Engine]
  B --> C[SQL Server Container]
  B --> D[Umbraco v13 Container]
  C --> E[(sql_data Volume)]
  D --> F[(./umbraco Volume)]
  D --> C
  C --> D
```

---

## ğŸ§ª Tips & Gotchas

| Problem                     | Solution                                                                    |
| --------------------------- | --------------------------------------------------------------------------- |
| ğŸŒ Umbraco hangs on startup | SQL container might not be ready. Restart Umbraco or use healthcheck logic. |
| ğŸ§¯ SQL login failed         | Make sure SA password matches, and DB is created automatically              |
| âš ï¸ Media not persisting     | Ensure `./umbraco` folder exists and is mounted properly                    |
| ğŸ”„ Reset clean              | `docker compose down -v` to reset everything                                |

---

## âœ… Summary

With this setup, you now have:

âœ… **Umbraco v13 running in Docker**
âœ… **SQL Server with persisted database**
âœ… **Media/config saved between restarts**
âœ… **No manual install steps â€“ fully automated**
